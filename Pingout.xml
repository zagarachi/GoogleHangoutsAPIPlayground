<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <!-- Licensed under the Apache License, Version 2.0 (the "License"); you may not
     * use this file except in compliance with the License. You may obtain a copy of
     * the License at
     *
     * http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
     * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
     * License for the specific language governing permissions and limitations under
     * the License
    -->
    <ModulePrefs title="Hangout Starter">
        <Require feature="rpc" />
        <Require feature="views" />
        <Require feature="locked-domain" />
    </ModulePrefs>
    <Content type="html"><![CDATA[
		<div id='wrap'>
			<div id='main'>
			<p>
				<canvas id="canvas" width=600 height=400>Your browser does not support canvas, alas.
				This demo will not be as much fun.  Have you considered Google Chrome?
				</canvas>
				</p>
			</div>
			<div id='text'>
				<input type='checkbox'
					value='true' 
					id='mirror'
					checked='true'
					onClick='onMirrorClicked()'>Mirror?</input>
				<p>This demo demonstrates the Hangouts API face movement endpoints.</p>
				<p>Each of the points represents a location on your face; note that
				the 'mouth' is really the center of your mouth and your upper lip, not a
				a complete rendering of your mouth state.</p>
				<p>Roll, pan, and tilt represent your head orientation.</p>
				<p>Your own video feed is mirrored to you, but the face data is
				as you are seen.  Check the checkbox to mirror and unmirror your data.</p>
			</div>
		</div>
        <script src="https://hangoutsapi.talkgadget.google.com/hangouts/api/hangout.js?v=1.2"></script>
        <script>
            // Keep track of this
			var canvas = document.getElementById('canvas');
            var ball = new Image();
            var overlay = '';

			gapi.hangout.onApiReady.add(
				function(eventObj) {
					if (eventObj.isApiReady) {
						ball.src = 'https://raw.github.com/zagarachi/GoogleHangoutsAPIPlayground/master/arrow.png';
						animate();
					}
				}
			);
			
			/** Animation loop */
			function animate(){
				drawFrame();
				// request new frame
				requestAnimFrame(function () {
					animate();
				});
			}
			
			function drawFrame(){
				var context = canvas.getContext('2d');
				// Clear the canvas
				context.setTransform(1,0,0,1,0,0);
				context.fillStyle = 'rgb(0,0,0)';
				context.fillRect(0,0,600,400);
				
				context.drawImage(ball,0,0);
				
			}
			
			/** Standard requestAnimFrame from paulirish.com, running 30 fps */
			window.requestAnimFrame = (function (callback) {
				return window.requestAnimationFrame ||
				window.webkitRequestAnimationFrame ||
				window.mozRequestAnimationFrame ||
				window.oRequestAnimationFrame ||
				window.msRequestAnimationFrame ||
				function(callback){
					window.setTimeout(callback, 1000 / 30);
				};
			})();
			
        </script>
        ]]>
</Content>
</Module>

